<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.stusyshomework.mapper.StudentCourseMapper">

    <resultMap id="StudentCourseResultMap" type="StudentCourseMB">
        <id property="id" column="id"/>
        <result property="studentId" column="student_id"/>
        <result property="courseId" column="course_id"/>
    </resultMap>

    <resultMap id="CourseResultMap" type="CourseMB">
        <id property="courseId" column="course_id"/>
        <result property="courseName" column="course_name"/>
        <result property="term" column="term"/>
        <result property="description" column="description"/>
        <result property="credit" column="credit"/>
    </resultMap>

    <resultMap id="StudentResultMap" type="StudentMB">
        <id property="studentId" column="student_no"/>
        <result property="name" column="name"/>
        <result property="major" column="department"/>
        <result property="grade" column="class_name"/>
    </resultMap>

    <select id="findCourseIdsByStudentId" resultType="string">
        SELECT course_id
        FROM student_course
        WHERE student_id = #{studentId}
    </select>

    <select id="findCoursesByStudentId" resultMap="CourseResultMap">
        SELECT c.course_id, c.course_name, c.term, c.description, c.credit
        FROM course c
        INNER JOIN student_course sc ON c.course_id = sc.course_id
        WHERE sc.student_id = #{studentId}
        ORDER BY c.course_id
    </select>

    <select id="findStudentIdsByCourseId" resultType="string">
        SELECT student_id
        FROM student_course
        WHERE course_id = #{courseId}
    </select>

    <select id="findStudentsByCourseId" resultMap="StudentResultMap">
        SELECT s.student_no, s.name, s.department, s.class_name
        FROM students s
        INNER JOIN student_course sc ON s.student_no = sc.student_id
        WHERE sc.course_id = #{courseId}
        ORDER BY s.student_no
    </select>

    <insert id="insert">
        INSERT INTO student_course (student_id, course_id)
        VALUES (#{studentId}, #{courseId})
    </insert>

    <delete id="delete">
        DELETE FROM student_course
        WHERE student_id = #{studentId} AND course_id = #{courseId}
    </delete>

    <delete id="deleteByStudentId">
        DELETE FROM student_course
        WHERE student_id = #{studentId}
    </delete>

    <delete id="deleteByCourseId">
        DELETE FROM student_course
        WHERE course_id = #{courseId}
    </delete>

    <select id="findByStudentAndCourse" resultMap="StudentCourseResultMap">
        SELECT id, student_id, course_id
        FROM student_course
        WHERE student_id = #{studentId} AND course_id = #{courseId}
    </select>

</mapper>
