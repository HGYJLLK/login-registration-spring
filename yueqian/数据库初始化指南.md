# 数据库初始化指南

## 数据库配置信息

- **数据库名称**: `queqian`
- **用户名**: `root`
- **密码**: `2333`
- **端口**: `3306`

## 初始化步骤

### 1. 确保MySQL正在运行

```bash
# 检查MySQL是否运行
mysql.server status

# 如果没运行，启动MySQL
mysql.server start
```

### 2. 执行SQL脚本（按顺序）

```bash
# 进入项目的yueqian目录
cd /Users/yuminghu/Documents/GitHub/login-registration-spring/yueqian

# 1. 执行基础数据库创建（如果还没有）
mysql -u root -p2333 < database_setup.sql

# 2. 更新用户表添加头像字段
mysql -u root -p2333 queqian < database_update.sql

# 3. 创建歌单相关表
mysql -u root -p2333 queqian < database_songlist_setup.sql

# 4. 创建收藏表
mysql -u root -p2333 queqian < database_favorite_setup.sql
```

### 3. 验证数据库表

```bash
# 登录MySQL
mysql -u root -p2333

# 使用queqian数据库
USE queqian;

# 查看所有表
SHOW TABLES;

# 应该看到以下表：
# - tb_admin (管理员表)
# - tb_consumer (用户表，有avatarUrl字段)
# - tb_singer (歌手表)
# - tb_song (歌曲表)
# - tb_song_list (歌单表)
# - tb_list_song (歌单-歌曲关联表)
# - tb_favorite (收藏表)
```

## 需要的表结构

### tb_consumer (用户表)
- id, username, password, name, gender, phonenumber, **avatarUrl**

### tb_singer (歌手表)
- id, name, picUrl, introduction, location

### tb_song (歌曲表)
- id, singerId, name, introduction, pic, lyric, url, duration

### tb_song_list (歌单表)
- id, title, picUrl, introduction, style

### tb_list_song (歌单-歌曲关联表)
- id, songListId, songId

### tb_favorite (收藏表)
- id, user_id, song_id, create_time

## 后端配置检查

确保 `application.properties` 有以下配置：

```properties
spring.datasource.url=jdbc:mysql://localhost:3306/queqian?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&characterEncoding=UTF-8&useUnicode=true&connectionCollation=utf8mb4_unicode_ci
spring.datasource.username=root
spring.datasource.password=2333
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
```

## 文件上传目录

后端会在以下位置存储上传的文件：
```
~/music-uploads/
  ├── avatars/      (用户头像)
  ├── singer-pics/  (歌手图片)
  ├── songs/        (歌曲文件)
  └── song-pics/    (歌曲封面)
```

## 启动项目

1. **启动后端**：
   ```bash
   cd yueqian
   ./mvnw spring-boot:run
   # 后端运行在 http://localhost:8082
   ```

2. **启动前端**：
   ```bash
   cd yueqian_homework
   npm install  # 首次运行需要
   npm run dev
   # 前端运行在 http://localhost:3000
   ```

## 访问地址

- **用户端**: http://localhost:3000/login
- **管理端**: http://localhost:3000/admin

## 常见问题

### 1. 乱码问题
如果遇到中文乱码，确保：
- 数据库使用 utf8mb4 字符集
- 连接URL中包含 `characterEncoding=UTF-8&useUnicode=true&connectionCollation=utf8mb4_unicode_ci`
- 后端需要重启

### 2. 表不存在
按顺序执行所有SQL脚本，特别是：
- database_songlist_setup.sql（歌单表）
- database_favorite_setup.sql（收藏表）

### 3. 文件上传失败
确保 `~/music-uploads/` 目录存在且有写入权限
