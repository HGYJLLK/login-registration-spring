# 音乐管理系统 - 管理员端使用说明

## 访问地址
管理员端地址: http://localhost:3000/home/admin

## 功能概述

管理员端是一个完整的音乐后台管理系统,包含以下四个主要模块:

### 1. 用户管理模块 ✅ 已完成
- **功能**: 管理系统中的所有用户
- **特性**:
  - 用户列表展示(ID、头像、用户名、姓名、性别、手机号)
  - 用户信息编辑
  - 用户头像上传
  - 用户删除
  - 实时数据更新

### 2. 歌手管理模块 ✅ 已完成
- **功能**: 管理歌手信息
- **特性**:
  - 歌手列表展示(ID、图片、歌手名、简介)
  - 添加新歌手
  - 编辑歌手信息
  - 歌手图片上传
  - 删除歌手
  - 实时数据更新

### 3. 音乐管理模块 ✅ 已完成
- **功能**: 管理音乐文件和信息
- **特性**:
  - 音乐列表展示(ID、封面、歌曲名、歌手、时长)
  - 添加新音乐
  - 编辑音乐信息
  - 音乐文件上传(MP3)
  - 歌曲封面上传
  - 歌词编辑
  - 歌手关联选择
  - 删除音乐
  - 实时数据更新

### 4. 歌单管理模块 ⏳ 待开发
- **状态**: 界面已预留,功能待实现
- **计划功能**:
  - 创建歌单
  - 编辑歌单信息
  - 添加/删除歌单中的歌曲
  - 歌单封面上传

## 技术实现

### 后端新增功能

#### 1. 文件上传Controller
文件: `FileUploadController.java`

**支持的文件类型**:
- 用户头像 (POST `/api/file/avatar`)
- 歌手图片 (POST `/api/file/singer-pic`)
- 音乐文件 (POST `/api/file/song`)
- 歌曲封面 (POST `/api/file/song-pic`)

**文件存储位置**: `~/music-uploads/`
- 头像: `~/music-uploads/avatars/`
- 歌手图片: `~/music-uploads/singers/`
- 音乐文件: `~/music-uploads/songs/`
- 歌曲封面: `~/music-uploads/song-pics/`

**文件访问**:
- GET `/api/file/avatars/{filename}` - 访问头像
- GET `/api/file/singers/{filename}` - 访问歌手图片
- GET `/api/file/songs/{filename}` - 访问音乐文件
- GET `/api/file/song-pics/{filename}` - 访问歌曲封面

**文件删除**:
- DELETE `/api/file/delete?url={fileUrl}`

#### 2. User模型更新
新增字段: `avatarUrl` (varchar(500)) - 用于存储用户头像URL

#### 3. 现有API接口
**用户管理**:
- GET `/api/users` - 获取所有用户
- PUT `/api/users/{id}` - 更新用户信息
- DELETE `/api/users/{id}` - 删除用户

**歌手管理**:
- GET `/api/music/singer` - 获取所有歌手
- POST `/api/music/singer/add` - 添加歌手
- POST `/api/music/singer/update` - 更新歌手
- DELETE `/api/music/singer/delete?id={id}` - 删除歌手

**音乐管理**:
- GET `/api/music/song` - 获取所有音乐
- POST `/api/music/song/add` - 添加音乐
- POST `/api/music/song/update` - 更新音乐
- DELETE `/api/music/song/delete?id={id}` - 删除音乐

### 前端新增功能

#### 1. 管理员页面组件
文件: `src/pages/Admin.vue`

**页面布局**:
- 顶部导航栏: 显示系统名称和退出登录按钮
- 左侧菜单栏: 四个功能模块入口
- 主内容区域: 各模块的数据展示和操作界面

**核心功能**:
- 动态表格展示
- 对话框编辑
- 文件上传组件
- 异步数据请求
- 实时数据更新

#### 2. 路由配置更新
文件: `src/router/index.js`

新增路由:
```javascript
{
  path: '/home/admin',
  name: 'admin',
  component: Admin
}
```

## 数据库更新

执行以下SQL脚本更新数据库结构:

```bash
cd /Users/yuminghu/Documents/GitHub/login-registration-spring/yueqian
mysql -u root -p2333 queqian < database_update.sql
```

或手动执行:
```sql
USE queqian;
ALTER TABLE tb_user
ADD COLUMN avatar_url VARCHAR(500) DEFAULT NULL COMMENT '用户头像URL';
```

## 启动步骤

### 1. 启动后端
```bash
cd /Users/yuminghu/Documents/GitHub/login-registration-spring/yueqian
./mvnw spring-boot:run
```

### 2. 启动前端
```bash
cd /Users/yuminghu/Documents/GitHub/login-registration-spring/yueqian/music-client
npm run dev
```

### 3. 访问管理员端
打开浏览器访问: http://localhost:3000/home/admin

## 使用指南

### 用户管理
1. 点击左侧"用户管理"菜单
2. 查看用户列表
3. 点击"编辑"按钮修改用户信息
4. 在编辑对话框中可以上传用户头像
5. 点击"删除"按钮删除用户(需确认)

### 歌手管理
1. 点击左侧"歌手管理"菜单
2. 点击"添加歌手"按钮创建新歌手
3. 填写歌手信息:
   - 上传歌手图片
   - 输入歌手名称
   - 输入歌手简介
4. 点击"保存"提交
5. 可以编辑或删除已有歌手

### 音乐管理
1. 点击左侧"音乐管理"菜单
2. 点击"添加音乐"按钮创建新音乐
3. 填写音乐信息:
   - 上传歌曲封面图片
   - 输入歌曲名称
   - 选择歌手(从下拉列表中)
   - 上传MP3音乐文件
   - 输入歌词
   - 设置歌曲时长(秒)
4. 点击"保存"提交
5. 可以编辑或删除已有音乐

## 文件上传说明

### 支持的文件格式
- **图片**: JPG, PNG, GIF (用于头像、歌手图片、歌曲封面)
- **音乐**: MP3 (用于音乐文件)

### 上传限制
- 文件会自动重命名为UUID格式,防止文件名冲突
- 上传的文件存储在服务器的 `~/music-uploads/` 目录下
- 建议图片大小不超过5MB,音乐文件不超过50MB

### 文件访问
所有上传的文件都可以通过HTTP请求访问:
- 头像: `http://localhost:8082/api/file/avatars/{filename}`
- 歌手图片: `http://localhost:8082/api/file/singers/{filename}`
- 音乐文件: `http://localhost:8082/api/file/songs/{filename}`
- 歌曲封面: `http://localhost:8082/api/file/song-pics/{filename}`

## 待完成功能

### 歌单模块
需要实现以下功能:

1. **后端**:
   - 创建 `SongList` 实体类
   - 创建 `ListSong` 实体类(歌单-歌曲关联表)
   - 实现歌单CRUD的Repository和Service
   - 添加歌单管理的Controller API

2. **前端**:
   - 歌单列表展示
   - 添加/编辑歌单对话框
   - 歌单歌曲关联管理
   - 歌单封面上传

## 注意事项

1. **跨域配置**: 后端已配置允许 `http://localhost:3000` 访问
2. **文件存储**: 上传的文件存储在用户主目录下的 `music-uploads` 文件夹
3. **权限控制**: 当前版本未实现登录验证,建议在生产环境中添加JWT或Session验证
4. **数据库**: 确保MySQL服务正在运行且数据库 `queqian` 已创建
5. **端口占用**: 确保8082(后端)和3000(前端)端口未被占用

## 技术栈

### 后端
- Spring Boot 3.4.5
- Spring Data JPA
- MySQL
- MultipartFile (文件上传)

### 前端
- Vue 2.x
- Element UI
- Axios
- Vue Router

## 项目结构

```
yueqian/
├── src/main/java/com/example/login/
│   ├── controller/
│   │   ├── FileUploadController.java (新增)
│   │   ├── UserController.java (已更新)
│   │   ├── MusicController.java
│   │   └── AuthController.java
│   └── model/
│       ├── User.java (已更新 - 添加avatarUrl字段)
│       ├── Singer.java
│       └── Song.java
├── music-client/src/
│   ├── pages/
│   │   └── Admin.vue (新增)
│   └── router/
│       └── index.js (已更新)
├── database_update.sql (新增)
└── 管理员端说明.md (本文档)
```

## 开发建议

1. 在生产环境中应该使用云存储服务(如阿里云OSS)替代本地文件存储
2. 添加文件大小和类型验证
3. 实现管理员登录和权限验证
4. 添加数据分页功能
5. 实现搜索和筛选功能
6. 添加操作日志记录
7. 优化图片显示(添加加载状态和错误处理)
8. 实现批量操作功能

## 问题排查

### 文件上传失败
- 检查上传目录是否有写权限
- 检查文件大小是否超过限制
- 查看浏览器控制台错误信息

### 数据加载失败
- 检查后端服务是否正常运行(http://localhost:8082)
- 检查数据库连接是否正常
- 查看浏览器Network面板的API请求状态

### 图片显示问题
- 检查图片URL是否正确
- 确保文件已成功上传到服务器
- 检查跨域配置是否正确

## 联系方式

如有问题,请查看项目文档或联系开发团队。
